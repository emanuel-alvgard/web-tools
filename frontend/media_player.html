<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>frontend</title>
</head>
<body style="opacity:1; margin:0px">

    <div class="b-hero-page-content"></div>

    <script>

        let delta = 0;
        let time = performance.now();

        let elements = [document.getElementsByClassName("b-hero-page-content")[0]];

        let x = [0];
        let y = [0];
        let width = [0];
        let height = [0];
        let background_color = [0];
        let text = [0];
        let border_radius = [0];

        for (let i = 1; i < 8; i++) {
            elements.push(document.createElement("div"));
            elements[i].style.position = "absolute";
            elements[i].style.margin = "0px";
            elements[i].style.padding = "0px";
            elements[i].style.border = "none";
            elements[i].style.left = "0px";
            elements[i].style.top = "0px";
            elements[i].style.width = "0px";
            elements[i].style.height = "0px";
            elements[i].style.zIndex = "0";
            elements[i].style.overflow = "hidden";
            elements[0].append(elements[i]);

            x.push(0);
            y.push(0);
            width.push(0);
            height.push(0);
            background_color.push([255, 255, 255, 1]);
            text.push("");
            border_radius.push(0);
        }

        let e_play_button = 1;
        let e_progress_bar = 2;
        let e_progress_indicator = 3;
        let e_playhead = 4;
        let e_time_current = 5;
        let e_time_left = 6;

        let playing = 0;
        let time_max_ms = 180000;
        let time_current_ms = 0;
        let time_left_ms = 0;

        let time_max_m = time_max_ms * 0.0000166666;
        time_max_m = time_max_m.toFixed(0);

        console.log(time_max_m);

        let time_current_m = 0;
        let time_current_s = 0;

        let audio = new Audio();
        // set audio src


        // INIT

        // e_play_button
        background_color[1] = [200, 200, 200, 1];
        width[1] = 100;
        height[1] = 100;

        // e_progress_bar
        background_color[2] = [200, 200, 200, 1];
        x[2] = 50;
        width[2] = (width[0] - x[2]) - 50;
        height[2] = 7;
        y[2] = height[0] - (height[2] / 2);
        border_radius[2] = 10;

        // e_progress_indicator
        background_color[3] = [240, 175, 11, 1];
        x[3] = 50;
        width[3] = 50; // this will be controlled by time_current_ms
        height[3] = 7;
        y[3] = height[0] - (height[3] / 2);
        border_radius[3] = 10;

        // e_playhead
        elements[4].style.zIndex = "1";
        elements[4].style.boxShadow = "0.3px 0.3px 2px gray";
        background_color[4] = [240, 175, 11, 1];
        width[4] = 12; // this will be controlled by time_current_ms
        x[4] = (x[3] + width[3]) - (width[4] / 2);
        height[4] = 12;
        y[4] = height[0] - (height[4] / 2);
        border_radius[4] = 10;

        // e_time_current
        elements[e_time_current].style.width = "auto";
        elements[e_time_current].style.heighy = "auto";

        // e_time_left
        elements[e_time_left].style.width = "auto";
        elements[e_time_left].style.height = "auto";

        let click = 0;
        let mouse_pos = 0;
        let drag = 0;

        window.addEventListener("mouseup", function (event) {
            drag = 0;
        });
        window.addEventListener("mousemove", function (event) {
            mouse_pos = event.clientX;
        });

        elements[1].addEventListener("mousedown", function (event) {
            if (playing === 1) { playing = 0; }
            else { playing = 1; }
        });


        elements[2].addEventListener("mousedown", function (event) {
            click = 1;
        });

        elements[3].addEventListener("mousedown", function (event) {
            click = 1;
        });

        elements[4].addEventListener("mousedown", function (event) {;
            width[3] = mouse_pos - x[3];
            drag = 1;
        });

        elements[e_progress_bar].addEventListener('dragstart', (event) => { event.preventDefault() });
        elements[e_progress_indicator].addEventListener('dragstart', (event) => { event.preventDefault() });
        elements[e_playhead].addEventListener('dragstart', (event) => { event.preventDefault() });

        function update_player() {

            // e_play_button
            x[1] = (width[0] * 0.5) - (width[1] * 0.5);
            y[1] = (height[0] * 0.5) - (height[1] * 0.5);

            // e_progress_bar
            width[2] = (width[0] - x[2]) - 50;
            y[2] = height[0] - (height[2] / 2);

            // e_progress_indicator
            width[3] = width[2] * (time_current_ms / time_max_ms);
            if (click === 1) { width[3] = mouse_pos - x[3]; }
            y[3] = height[0] - (height[3] / 2);
            if (drag === 1) { width[3] = mouse_pos - x[3]; }
            if (width[3] > width[2]) { width[3] = width[2]; }
            else if (width[3] < 0) { width[3] = 0; }

            // e_playhead
            x[4] = (x[3] + width[3]) - (width[4] * 0.5);
            y[4] = height[0] - (height[4] * 0.5);

            // e_time_current
            if (playing === 1) { time_current_ms += delta; }
            if (time_current_ms > time_max_ms) { time_current_ms = time_max_ms; }
            if (click === 1 || drag === 1) {
                time_current_ms = time_max_ms * (width[3] / width[2]);
            }
            background_color[5] = [200, 200, 200, 0];
            height[5] = elements[e_time_current].clientHeight;
            x[5] = 50;
            y[5] = (y[2] - height[5]) - 5;
            width[5] = elements[e_time_current].clientWidth;

            text[5] = (time_current_ms * 0.00001);
            text[5] = text[5].toFixed(2);

            // e_time_left
            time_left = time_max_ms - time_current_ms;

            background_color[6] = [200, 200, 200, 0];
            height[6] = elements[e_time_left].clientHeight;
            width[6] = elements[e_time_left].clientWidth;
            x[6] = (x[2] + width[2] - width[e_time_left]);
            y[6] = (y[2] - height[5]) - 5;
            text[6] = (time_left * 0.001) / 60;
            text[6] = "-" + text[6].toFixed(2);

            // RESET EVENTS
            click = 0;
        }


        function update() {

            let new_time = performance.now();
            delta = new_time - time;
            time = new_time;


            // @TEST
            elements[0].style.width = (document.documentElement.clientWidth - 100) + "px";
            elements[0].style.height = (document.documentElement.clientHeight - 300) + "px";
            elements[0].style.border = "solid";
            elements[0].style.padding = "0px";
            elements[0].style.margin = "0px";

            width[0] = elements[0].clientWidth;
            height[0] = elements[0].clientHeight;

            update_player();

            for (let i = 1; i < elements.length; i++) {
                elements[i].style.transform = "translate(" + x[i] + "px, " + y[i] + "px)";
                if (i === e_time_current || i === e_time_left) {
                    elements[i].style.width = "auto";
                    elements[i].style.height = "auto";
                }
                else {
                    elements[i].style.width = width[i] + "px";
                    elements[i].style.height = height[i] + "px";
                }
                elements[i].style.backgroundColor = "rgba(" + background_color[i][0] + "," + background_color[i][1] + "," + background_color[i][2] + "," + background_color[i][3] + ")";
                elements[i].textContent = text[i];
                elements[i].style.borderRadius = border_radius[i] + "px";
            }

            window.requestAnimationFrame(update);
        }

        update();


    </script>
</body>
</html>