<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>frontend</title>
</head>
<body style="opacity:1; margin:0px">

    <div class="b-hero-page-content"></div>

    <script>

        let elements = [document.getElementsByClassName("b-hero-page-content")[0]];

        let x = [0];
        let y = [0];
        let width = [0];
        let height = [0];
        let background_color = [0];
        let text = [0];
        let border_radius = [0];

        for (let i = 1; i < 8; i++) {
            elements.push(document.createElement("div"));
            elements[i].style.position = "absolute";
            elements[i].style.margin = "0px";
            elements[i].style.padding = "0px";
            elements[i].style.border = "none";
            elements[i].style.left = "0px";
            elements[i].style.top = "0px";
            elements[i].style.width = "0px";
            elements[i].style.height = "0px";
            elements[i].style.zIndex = "0";
            elements[i].style.overflow = "hidden";
            elements[0].append(elements[i]);

            x.push(0);
            y.push(0);
            width.push(0);
            height.push(0);
            background_color.push([255, 255, 255, 1]);
            text.push("");
            border_radius.push(0);
        }

        let e_play_button = 1;
        let e_progress_bar = 2;
        let e_progress_indicator = 3;
        let e_playhead = 4;
        let e_time_current = 5;
        let e_time_left = 6;

        let time_max = 180000;
        let time_current = 0;
        let time_left = 0;

        let audio = document.createElement("audio");
        elements[0].append(audio);
        // set audio src

        // @TEST
        elements[0].style.width = "300px";
        elements[0].style.height = "300px";
        elements[0].style.border = "solid";
        elements[0].style.padding = "0px";
        elements[0].style.margin = "0px";


        // INIT

        // e_progress_bar
        background_color[2] = [200, 200, 200, 1];
        x[2] = 50;
        width[2] = (width[0] - x[2]) - 50;
        height[2] = 10;
        y[2] = height[0] - (height[2] / 2);
        border_radius[2] = 10;

        // e_progress_indicator
        background_color[3] = [240, 175, 11, 1];
        x[3] = 50;
        width[3] = 50; // this will be controlled by time_current
        height[3] = 10;
        y[3] = height[0] - (height[3] / 2);
        border_radius[3] = 10;

        // e_playhead
        elements[4].style.zIndex = "1";
        elements[4].style.boxShadow = "0.3px 0.3px 2px gray";
        background_color[4] = [240, 175, 11, 1];
        width[4] = 15; // this will be controlled by time_current
        x[4] = (x[3] + width[3]) - (width[4] / 2);
        height[4] = 15;
        y[4] = height[0] - (height[4] / 2);
        border_radius[4] = 10;

        let mouse_pos = 0;
        let drag = 0;

        window.addEventListener("mouseup", function (event) {
            drag = 0;
        });
        window.addEventListener("mousemove", function (event) {
            mouse_pos = event.clientX;
        });

        elements[2].addEventListener("mousedown", function (event) {
            width[3] = mouse_pos - x[3];
        });

        elements[3].addEventListener("mousedown", function (event) {
            width[3] = mouse_pos - x[3];
        });

        elements[4].addEventListener("mousedown", function (event) {
            width[3] = mouse_pos - x[3];
            drag = 1;
        });


        function update_player() {

            // e_progress_bar
            width[2] = (width[0] - x[2]) - 50;
            y[2] = height[0] - (height[2] / 2);

            // e_progress_indicator
            y[3] = height[0] - (height[3] / 2);
            if (drag === 1) { width[3] = mouse_pos - x[3]; }
            if (width[3] > width[2]) { width[3] = width[2]; }
            else if (width[3] < 0) { width[3] = 0; }

            // e_playhead
            x[4] = (x[3] + width[3]) - (width[4] / 2);
            y[4] = height[0] - (height[4] / 2);

            // e_time_current
            time_current = time_max * (width[3] / width[2]);

            background_color[5] = [200, 200, 200, 1];
            text[5] = time_max;
            height[5] = 20;
            x[5] = 50;
            y[5] = (y[2] - height[5]) - 5;
            width[5] = 50;
            text[5] = (time_current * 0.001) / 60;
            text[5] = text[5].toFixed(2);
        }


        function update() {

            width[0] = parseInt(elements[0].style.width.replace("px", ""));
            height[0] = parseInt(elements[0].style.height.replace("px", ""));

            update_player();

            for (let i = 1; i < elements.length; i++) {
                elements[i].style.transform = "translate(" + x[i] + "px, " + y[i] + "px)";
                elements[i].style.width = width[i] + "px";
                elements[i].style.height = height[i] + "px";
                elements[i].style.backgroundColor = "rgba(" + background_color[i][0] + "," + background_color[i][1] + "," + background_color[i][2] + "," + background_color[i][3] + ")";
                elements[i].textContent = text[i];
                elements[i].style.borderRadius = border_radius[i] + "px";
            }

            window.requestAnimationFrame(update);
        }

        update();


    </script>
</body>
</html>