<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>frontend</title>
</head>
<body style="opacity:1">

    <div>
        <div>hello</div>
        <div>hello</div>
        <div>hello</div>
        <div>hello</div>
        <div>hello</div>
    </div>

    <script>

        let time = performance.now();
        let delta = 0;


        // @DONE
        function init_dom() {
            
            let dom = { 
                b: document.body,
                e: [] 
            }

            let p = document.body.children[0];
            let c = p.children;
            dom.e.push(p);
            
            for (let i = 0; i < c.length; i++) {
                dom.e.push(c[i]);
            }
            for (let i = 0; i < dom.e.length; i++) {
                dom.e[i].style.position = "absolute";
                dom.e[i].style.margin = "0px";
                dom.e[i].style.padding = "0px";
                dom.e[i].style.border = "solid";
                dom.e[i].style.left = "0px";
                dom.e[i].style.top = "0px";
                dom.e[i].style.width = "0px";
                dom.e[i].style.height = "0px";
                dom.e[i].style.zIndex = "0";
                dom.e[i].style.overflow = "hidden";
            }
            return dom;
        }

        // VIEW TYPE
        const view = {

            // STATES 0 - 99
            x0: 0, // position
            x1: 1, // dimension
            x2: 2, // rotation
            y0: 3,
            y1: 4,
            y2: 5,
            z0: 6,
            z1: 7,
            z2: 8,

            // EVENTS 100 - 199
            mouse_down: 100,
            mouse_up: 101
        }

        // @DONE
        function init_views(size) {

            let views = {
                s: [], // state current frame
                p: [], // state previous frame
                e: [], // event

                // ANIMATION
                ar: [], // RUNNING
                ap: [], // PROGRESS
                at: [], // TIMER
                as: [], // SAMPLE
            }

            // STATE
            views.s.push(new Float32Array(size)); // x0
            views.s.push(new Float32Array(size)); // x1
            views.s.push(new Float32Array(size)); // x2
            views.s.push(new Float32Array(size)); // y0
            views.s.push(new Float32Array(size)); // y1
            views.s.push(new Float32Array(size)); // y2
            views.s.push(new Float32Array(size)); // z0
            views.s.push(new Float32Array(size)); // z1
            views.s.push(new Float32Array(size)); // z2

            // PREVIOUS
            views.p.push(new Float32Array(size)); // x0
            views.p.push(new Float32Array(size)); // x1
            views.p.push(new Float32Array(size)); // x2
            views.p.push(new Float32Array(size)); // y0
            views.p.push(new Float32Array(size)); // y1
            views.p.push(new Float32Array(size)); // y2
            views.p.push(new Float32Array(size)); // z0
            views.p.push(new Float32Array(size)); // z1
            views.p.push(new Float32Array(size)); // z2
            
            // ANIMATION
            for (let i = 0; i < size; i++) {
                views.ar.push(new Int8Array(views.s.length));
                views.ap.push(new Float32Array(views.s.length));
                views.at.push(new Float64Array(views.s.length));
                views.as.push(new Int32Array(views.s.length));
            }
            return views;
        }



        function update_dom(dom, views) {

            let dbb = document.documentElement.getBoundingClientRect();
            let bbb = dom.b.getBoundingClientRect();
            width = dbb.width;
            height = dbb.height;

            // RESIZE EVENT
            if (bbb.width !== width) { bbb.width = width; }
            if (bbb.height !== height) { bbb.height = height; }

            let i = 0;
            let len = dom.e.length;

            // @ADD simple diffing algorithm later

            while (i < len) { dom.e[i].style.width = (views.s[view.x1][i] - views.s[view.x0][i]) + "px"; i += 1; } i = 0;
            while (i < len) { dom.e[i].style.height = (views.s[view.y1][i]- views.s[view.y0][i]) + "px"; i += 1; } i = 0;
            while (i < len) { dom.e[i].style.transform = "translate(" + views.s[view.x0][i] + "px, " + views.s[view.y0][i] + "px) " + "rotate(" + views.s[view.z2][i] + "deg)"; i += 1; } i = 0;

            // clear dom events

        }


        function update_views(views) {

            //views.s[view.x1][0] = 

        }

       
        let dom = init_dom();
        let views = init_views(6);

        console.log(dom);

        function main() {

            let new_time = performance.now();
            delta = new_time - time;
            time = new_time;

            update_dom(dom, views);

            window.requestAnimationFrame(main);
        }

        main();
    
    </script>
</body>
</html>